<!DOCTYPE html>
<html lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>æ–°æŒ½å¾—ç•Œ - 3Dæ²™ç›’æ¸¸æˆ</title>
	<style>
		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}
		body {
			margin: 0;
			padding: 0;
			overflow: hidden;
			background: linear-gradient(to bottom, #1a2980, #26d0ce);
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
			touch-action: none;
			height: 100vh;
			display: flex;
			justify-content: center;
			align-items: center;
			color: white;
		}
		#gameContainer {
			position: relative;
			width: 100%;
			height: 100%;
			max-width: 1200px;
			max-height: 800px;
			box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
			border-radius: 8px;
			overflow: hidden;
		}
		canvas {
			display: block;
			width: 100%;
			height: 100%;
		}
		#ui {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
		}
		#info {
			position: absolute;
			top: 15px;
			left: 15px;
			color: white;
			background-color: rgba(0, 0, 0, 0.6);
			padding: 12px 15px;
			border-radius: 8px;
			font-size: 14px;
			line-height: 1.5;
			backdrop-filter: blur(5px);
			border: 1px solid rgba(255, 255, 255, 0.1);
			max-width: 200px;
		}
		#crosshair {
			position: absolute;
			top: 50%;
			left: 50%;
			width: 24px;
			height: 24px;
			transform: translate(-50%, -50%);
			pointer-events: none;
		}
		#crosshair::before, #crosshair::after {
			content: '';
			position: absolute;
			background-color: rgba(255, 255, 255, 0.8);
			border-radius: 1px;
		}
		#crosshair::before {
			width: 2px;
			height: 24px;
			left: 50%;
			transform: translateX(-50%);
		}
		#crosshair::after {
			width: 24px;
			height: 2px;
			top: 50%;
			transform: translateY(-50%);
		}
		#blockIndicator {
			position: absolute;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			background-color: rgba(0, 0, 0, 0.6);
			padding: 8px 15px;
			border-radius: 8px;
			color: white;
			font-size: 14px;
			backdrop-filter: blur(5px);
			border: 1px solid rgba(255, 255, 255, 0.1);
		}
		#mining-progress {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, 30px);
			width: 100px;
			height: 10px;
			background-color: rgba(0, 0, 0, 0.5);
			border-radius: 5px;
			overflow: hidden;
			display: none;
		}
		#mining-progress-bar {
			height: 100%;
			width: 0%;
			background-color: #ff9800;
			transition: width 0.1s;
		}
		#inventory {
			position: absolute;
			bottom: 20px;
			left: 50%;
			transform: translateX(-50%);
			display: flex;
			background-color: rgba(0, 0, 0, 0.6);
			padding: 8px;
			border-radius: 8px;
			backdrop-filter: blur(5px);
			border: 1px solid rgba(255, 255, 255, 0.1);
			gap: 5px;
		}
		.inventory-slot {
			width: 40px;
			height: 40px;
			background-color: rgba(255, 255, 255, 0.1);
			border-radius: 4px;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 20px;
			cursor: pointer;
			transition: all 0.2s;
			border: 2px solid transparent;
			position: relative;
		}
		.inventory-slot.active {
			border-color: #4CAF50;
			background-color: rgba(76, 175, 80, 0.2);
		}
		.inventory-slot:hover {
			background-color: rgba(255, 255, 255, 0.2);
		}
		.slot-count {
			position: absolute;
			bottom: 2px;
			right: 2px;
			font-size: 10px;
			background-color: rgba(0, 0, 0, 0.5);
			border-radius: 3px;
			padding: 0 3px;
		}
		#backpack {
			position: absolute;
			top: 50%;
			left: 50%;
			transform: translate(-50%, -50%);
			width: 400px;
			background-color: rgba(0, 0, 0, 0.8);
			border-radius: 10px;
			padding: 20px;
			backdrop-filter: blur(10px);
			border: 1px solid rgba(255, 255, 255, 0.2);
			display: none;
			z-index: 10;
		}
		#backpack h2 {
			text-align: center;
			margin-bottom: 15px;
			color: #fff;
		}
		.backpack-grid {
			display: grid;
			grid-template-columns: repeat(5, 1fr);
			gap: 10px;
		}
		.backpack-slot {
			width: 60px;
			height: 60px;
			background-color: rgba(255, 255, 255, 0.1);
			border-radius: 6px;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 24px;
			cursor: pointer;
			transition: all 0.2s;
			position: relative;
		}
		.backpack-slot:hover {
			background-color: rgba(255, 255, 255, 0.2);
		}
		#close-backpack {
			position: absolute;
			top: 10px;
			right: 10px;
			background: none;
			border: none;
			color: white;
			font-size: 20px;
			cursor: pointer;
		}
		#mobile-controls {
			position: absolute;
			bottom: 20px;
			width: 100%;
			display: none;
			justify-content: space-between;
			padding: 0 25px;
			box-sizing: border-box;
			pointer-events: none;
		}
		.joystick-container {
			position: relative;
			width: 120px;
			height: 120px;
			pointer-events: auto;
		}
		.joystick-base {
			width: 100%;
			height: 100%;
			background-color: rgba(255, 255, 255, 0.2);
			border-radius: 50%;
			backdrop-filter: blur(5px);
			border: 2px solid rgba(255, 255, 255, 0.3);
			box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
		}
		.joystick-handle {
			position: absolute;
			top: 50%;
			left: 50%;
			width: 50px;
			height: 50px;
			background-color: rgba(255, 255, 255, 0.7);
			border-radius: 50%;
			transform: translate(-50%, -50%);
			transition: transform 0.1s;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
		}
		.action-buttons {
			display: flex;
			flex-direction: column;
			align-items: center;
			pointer-events: auto;
		}
		.action-btn {
			width: 70px;
			height: 70px;
			background-color: rgba(255, 255, 255, 0.25);
			border-radius: 50%;
			margin: 8px;
			display: flex;
			justify-content: center;
			align-items: center;
			font-size: 28px;
			user-select: none;
			touch-action: manipulation;
			color: white;
			backdrop-filter: blur(5px);
			border: 2px solid rgba(255, 255, 255, 0.2);
			box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
			transition: all 0.1s;
		}
		.action-btn:active {
			background-color: rgba(255, 255, 255, 0.4);
			transform: scale(0.95);
		}
		#sensitivity-control {
			position: absolute;
			top: 15px;
			right: 15px;
			background-color: rgba(0, 0, 0, 0.6);
			padding: 10px 15px;
			border-radius: 8px;
			backdrop-filter: blur(5px);
			border: 1px solid rgba(255, 255, 255, 0.1);
			color: white;
			display: flex;
			flex-direction: column;
			align-items: center;
			gap: 8px;
		}
		#sensitivity-slider {
			width: 150px;
		}
		#loading {
			position: absolute;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			background: linear-gradient(to bottom, #1a2980, #26d0ce);
			display: flex;
			flex-direction: column;
			justify-content: center;
			align-items: center;
			color: white;
			z-index: 100;
			transition: opacity 0.5s;
		}
		#loading h1 {
			font-size: 2.5rem;
			margin-bottom: 20px;
			text-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
		}
		#loading p {
			font-size: 1.2rem;
			margin-bottom: 30px;
			text-align: center;
		}
		.progress-bar {
			width: 300px;
			height: 10px;
			background-color: rgba(255, 255, 255, 0.2);
			border-radius: 5px;
			overflow: hidden;
		}
		.progress {
			height: 100%;
			width: 0%;
			background-color: #4CAF50;
			transition: width 0.3s;
		}
		#error-message {
			color: #ff6b6b;
			margin-top: 20px;
			text-align: center;
			max-width: 80%;
			display: none;
		}
		@media (max-width: 768px) {
			#mobile-controls {
				display: flex;
			}
			#info {
				font-size: 12px;
				padding: 10px;
				max-width: 180px;
			}
			#inventory {
				bottom: 100px;
			}
			#backpack {
				width: 90%;
			}
			.backpack-grid {
				grid-template-columns: repeat(4, 1fr);
			}
		}
	</style>
</head>
<body>
	<div id="loading">
		<h1>æ–°æŒ½å¾—ç•Œ</h1>
		<p>æ­£åœ¨åŠ è½½æ¸¸æˆèµ„æº...</p>
		<div class="progress-bar">
			<div class="progress" id="progress"></div>
		</div>
		<div id="error-message"></div>
	</div>

	<div id="gameContainer">
		<div id="ui">
			<div id="info">
				ç§»åŠ¨: WASD/æ–¹å‘é”®<br>
				è·³è·ƒ: ç©ºæ ¼é”®<br>
				ç ´åæ–¹å—: å·¦é”®ç‚¹å‡»<br>
				æ”¾ç½®æ–¹å—: å³é”®ç‚¹å‡»<br>
				èƒŒåŒ…: Eé”®<br>
				åˆ‡æ¢æ–¹å—: æ•°å­—é”®1-5æˆ–æ»šè½®
			</div>
			<div id="sensitivity-control">
				<div>è§†è§’çµæ•åº¦</div>
				<input type="range" id="sensitivity-slider" min="0.5" max="3" step="0.1" value="1.5">
				<div id="sensitivity-value">1.5</div>
			</div>
			<div id="crosshair"></div>
			<div id="mining-progress">
				<div id="mining-progress-bar"></div>
			</div>
			<div id="blockIndicator">å½“å‰æ–¹å—: æ³¥åœŸ</div>
			<div id="inventory">
				<!-- ç‰©å“æ æ’æ§½å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
			</div>
			<div id="backpack">
				<h2>èƒŒåŒ…</h2>
				<button id="close-backpack">âœ•</button>
				<div class="backpack-grid">
					<!-- èƒŒåŒ…æ’æ§½å°†ç”±JavaScriptåŠ¨æ€ç”Ÿæˆ -->
				</div>
			</div>
			<div id="mobile-controls">
				<div class="joystick-container">
					<div class="joystick-base"></div>
					<div class="joystick-handle"></div>
				</div>
				<div class="action-buttons">
					<div class="action-btn" id="jump-btn">â†‘</div>
					<div class="action-btn" id="break-btn">ğŸ”¨</div>
					<div class="action-btn" id="place-btn">ğŸ§±</div>
					<div class="action-btn" id="backpack-btn">ğŸ’</div>
				</div>
			</div>
		</div>
	</div>

	<!-- ä½¿ç”¨å¯é çš„Three.js CDN -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
	
	<script>
		// æ£€æµ‹ç§»åŠ¨è®¾å¤‡
		const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

		// å…¨å±€å˜é‡
		let scene, camera, renderer;
		let blocks = new Map();
		let moveState = {
			forward: false,
			backward: false,
			left: false,
			right: false,
			jump: false
		};
		
		// ç‰©ç†å‚æ•°
		const gravity = -25;
		const velocity = new THREE.Vector3();
		const direction = new THREE.Vector3();
		const playerHeight = 1.8;
		const playerRadius = 0.5;
		let isOnGround = false;
		
		// è§†è§’æ§åˆ¶
		let pitch = 0;
		let yaw = 0;
		let mouseSensitivity = 1.5; // é»˜è®¤çµæ•åº¦
		
		// æ–¹å—ç±»å‹
		const blockTypes = [
			{ id: 'grass', name: 'è‰åœ°', icon: 'ğŸŒ¿', color: 0x7CFC00, hardness: 1.0 },
			{ id: 'dirt', name: 'æ³¥åœŸ', icon: 'ğŸŸ«', color: 0x8B4513, hardness: 0.8 },
			{ id: 'stone', name: 'çŸ³å¤´', icon: 'ğŸª¨', color: 0x808080, hardness: 2.0 },
			{ id: 'wood', name: 'æœ¨å¤´', icon: 'ğŸªµ', color: 0x8B4513, hardness: 1.2 },
			{ id: 'leaves', name: 'æ ‘å¶', icon: 'ğŸƒ', color: 0x228B22, hardness: 0.5 },
			{ id: 'sand', name: 'æ²™å­', icon: 'ğŸŸ¨', color: 0xF4D03F, hardness: 0.7 },
			{ id: 'water', name: 'æ°´', icon: 'ğŸ’§', color: 0x3498DB, hardness: 0.3 },
			{ id: 'glass', name: 'ç»ç’ƒ', icon: 'ğŸ”²', color: 0xBDC3C7, hardness: 0.9 },
			{ id: 'brick', name: 'ç –å—', icon: 'ğŸ§±', color: 0xC0392B, hardness: 1.5 },
			{ id: 'coal', name: 'ç…¤ç‚­', icon: 'âš«', color: 0x2C3E50, hardness: 1.8 }
		];
		let currentBlockType = 'dirt';
		
		// æŒ–æ˜è¿›åº¦
		let miningProgress = 0;
		let miningTarget = null;
		let isMining = false;
		let miningSpeed = 0.02;
		
		// ç‰©å“æ å’ŒèƒŒåŒ…ç³»ç»Ÿ
		let inventory = Array(5).fill(null);
		let backpack = Array(20).fill(null);
		let itemDrops = []; // æ‰è½ç‰©æ•°ç»„
		
		// åˆå§‹åŒ–ç‰©å“æ å’ŒèƒŒåŒ…
		function initInventory() {
			// åˆå§‹åŒ–ç‰©å“æ 
			inventory = [
				{ type: 'grass', count: 10 },
				{ type: 'dirt', count: 10 },
				{ type: 'stone', count: 10 },
				{ type: 'wood', count: 10 },
				{ type: 'leaves', count: 10 }
			];
			
			// åˆå§‹åŒ–èƒŒåŒ…
			backpack = [
				{ type: 'sand', count: 5 },
				{ type: 'water', count: 5 },
				{ type: 'glass', count: 5 },
				{ type: 'brick', count: 5 },
				{ type: 'coal', count: 5 },
				null, null, null, null, null,
				null, null, null, null, null,
				null, null, null, null, null
			];
			
			// åˆ›å»ºç‰©å“æ UI
			updateInventoryUI();
			
			// åˆ›å»ºèƒŒåŒ…UI
			updateBackpackUI();
			
			updateActiveInventorySlot();
		}
		
		// æ›´æ–°ç‰©å“æ UI
		function updateInventoryUI() {
			const inventoryElement = document.getElementById('inventory');
			inventoryElement.innerHTML = '';
			
			inventory.forEach((item, index) => {
				const slot = document.createElement('div');
				slot.className = 'inventory-slot';
				slot.dataset.index = index;
				
				if (item) {
					const blockType = blockTypes.find(b => b.id === item.type);
					slot.innerHTML = `${blockType.icon}<span class="slot-count">${item.count}</span>`;
				}
				
				slot.addEventListener('click', () => {
					if (item) {
						currentBlockType = item.type;
						updateBlockIndicator();
						updateActiveInventorySlot();
					}
				});
				
				inventoryElement.appendChild(slot);
			});
		}
		
		// æ›´æ–°èƒŒåŒ…UI
		function updateBackpackUI() {
			const backpackElement = document.querySelector('.backpack-grid');
			backpackElement.innerHTML = '';
			
			backpack.forEach((item, index) => {
				const slot = document.createElement('div');
				slot.className = 'backpack-slot';
				slot.dataset.index = index;
				
				if (item) {
					const blockType = blockTypes.find(b => b.id === item.type);
					slot.innerHTML = `${blockType.icon}<span class="slot-count">${item.count}</span>`;
				}
				
				slot.addEventListener('click', () => {
					if (item) {
						// æ·»åŠ åˆ°ç‰©å“æ å¦‚æœæœ‰ç©ºä½
						const emptySlotIndex = inventory.findIndex(slot => slot === null);
						if (emptySlotIndex !== -1) {
							inventory[emptySlotIndex] = { ...item };
							backpack[index] = null;
							updateInventoryUI();
							updateBackpackUI();
						}
					}
				});
				
				backpackElement.appendChild(slot);
			});
		}
		
		// æ›´æ–°æ´»åŠ¨ç‰©å“æ æ’æ§½
		function updateActiveInventorySlot() {
			const slots = document.querySelectorAll('.inventory-slot');
			slots.forEach((slot, index) => {
				const item = inventory[index];
				if (item && item.type === currentBlockType) {
					slot.classList.add('active');
				} else {
					slot.classList.remove('active');
				}
			});
		}
		
		// æ›´æ–°æ–¹å—æŒ‡ç¤ºå™¨
		function updateBlockIndicator() {
			const blockType = blockTypes.find(b => b.id === currentBlockType);
			document.getElementById('blockIndicator').textContent = `å½“å‰æ–¹å—: ${blockType.name}`;
		}
		
		// è™šæ‹Ÿæ‘‡æ†å˜é‡
		let joystickActive = false;
		let joystickPosition = { x: 0, y: 0 };
		let joystickOrigin = { x: 0, y: 0 };
		let joystickHandle = null;
		let joystickBase = null;
		
		// åŠ è½½çŠ¶æ€ç®¡ç†
		let resourcesLoaded = 0;
		const totalResources = 5;
		let gameInitialized = false;

		// æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
		function showError(message) {
			const errorEl = document.getElementById('error-message');
			errorEl.textContent = message;
			errorEl.style.display = 'block';
			console.error(message);
		}

		// æ›´æ–°åŠ è½½è¿›åº¦
		function updateProgress() {
			resourcesLoaded++;
			const progress = (resourcesLoaded / totalResources) * 100;
			document.getElementById('progress').style.width = `${progress}%`;
			
			if (resourcesLoaded >= totalResources && !gameInitialized) {
				gameInitialized = true;
				setTimeout(() => {
					document.getElementById('loading').style.opacity = '0';
					setTimeout(() => {
						document.getElementById('loading').style.display = 'none';
						// å¼€å§‹æ¸¸æˆå¾ªç¯
						animate();
					}, 500);
				}, 500);
			}
		}

		// åˆå§‹åŒ–å‡½æ•°
		function init() {
			try {
				// æ£€æŸ¥Three.jsæ˜¯å¦åŠ è½½æˆåŠŸ
				if (typeof THREE === 'undefined') {
					throw new Error('Three.jsåº“åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
				}

				// åˆ›å»ºåœºæ™¯
				scene = new THREE.Scene();
				scene.background = new THREE.Color(0x87CEEB);
				scene.fog = new THREE.Fog(0x87CEEB, 20, 100);
				updateProgress();

				// åˆ›å»ºç›¸æœº
				camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
				camera.position.set(0, 10, 0);
				updateProgress();

				// åˆ›å»ºæ¸²æŸ“å™¨
				const container = document.getElementById('gameContainer');
				renderer = new THREE.WebGLRenderer({ 
					antialias: true,
					powerPreference: "high-performance"
				});
				renderer.setSize(container.clientWidth, container.clientHeight);
				renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
				container.appendChild(renderer.domElement);
				updateProgress();

				// æ·»åŠ å…‰æº
				const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
				scene.add(ambientLight);

				const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
				directionalLight.position.set(50, 50, 25);
				scene.add(directionalLight);
				updateProgress();

				// åˆ›å»ºä¸–ç•Œ
				createWorld();
				updateProgress();

				// åˆå§‹åŒ–ç‰©å“æ å’ŒèƒŒåŒ…
				initInventory();
				
				// è®¾ç½®äº‹ä»¶ç›‘å¬
				setupEventListeners();
				
				// åˆå§‹åŒ–è™šæ‹Ÿæ‘‡æ†
				if (isMobile) {
					initJoystick();
				}
				
			} catch (error) {
				showError(`åˆå§‹åŒ–é”™è¯¯: ${error.message}`);
			}
		}

		// åˆå§‹åŒ–è™šæ‹Ÿæ‘‡æ†
		function initJoystick() {
			joystickHandle = document.querySelector('.joystick-handle');
			joystickBase = document.querySelector('.joystick-base');
			const joystickContainer = document.querySelector('.joystick-container');
			
			// è·å–æ‘‡æ†å®¹å™¨ä½ç½®å’Œå¤§å°
			const rect = joystickContainer.getBoundingClientRect();
			joystickOrigin.x = rect.left + rect.width / 2;
			joystickOrigin.y = rect.top + rect.height / 2;
			
			// æ‘‡æ†è§¦æ‘¸äº‹ä»¶
			joystickContainer.addEventListener('touchstart', handleJoystickStart);
			document.addEventListener('touchmove', handleJoystickMove);
			document.addEventListener('touchend', handleJoystickEnd);
		}

		// å¤„ç†æ‘‡æ†å¼€å§‹
		function handleJoystickStart(e) {
			e.preventDefault();
			joystickActive = true;
			updateJoystickPosition(e.touches[0]);
		}

		// å¤„ç†æ‘‡æ†ç§»åŠ¨
		function handleJoystickMove(e) {
			if (!joystickActive) return;
			e.preventDefault();
			updateJoystickPosition(e.touches[0]);
		}

		// å¤„ç†æ‘‡æ†ç»“æŸ
		function handleJoystickEnd(e) {
			joystickActive = false;
			resetJoystick();
		}

		// æ›´æ–°æ‘‡æ†ä½ç½®
		function updateJoystickPosition(touch) {
			const rect = document.querySelector('.joystick-container').getBoundingClientRect();
			const baseRadius = rect.width / 2;
			const handleRadius = 25; // æ‘‡æ†æ‰‹æŸ„åŠå¾„
			
			// è®¡ç®—ç›¸å¯¹äºæ‘‡æ†ä¸­å¿ƒçš„ä½ç½®
			const touchX = touch.clientX - joystickOrigin.x;
			const touchY = touch.clientY - joystickOrigin.y;
			
			// è®¡ç®—è·ç¦»
			const distance = Math.sqrt(touchX * touchX + touchY * touchY);
			const maxDistance = baseRadius - handleRadius;
			
			// é™åˆ¶æ‘‡æ†åœ¨åº•åº§èŒƒå›´å†…
			if (distance > maxDistance) {
				const angle = Math.atan2(touchY, touchX);
				joystickPosition.x = Math.cos(angle) * maxDistance;
				joystickPosition.y = Math.sin(angle) * maxDistance;
			} else {
				joystickPosition.x = touchX;
				joystickPosition.y = touchY;
			}
			
			// æ›´æ–°æ‘‡æ†æ‰‹æŸ„ä½ç½®
			joystickHandle.style.transform = `translate(calc(-50% + ${joystickPosition.x}px), calc(-50% + ${joystickPosition.y}px))`;
			
			// æ›´æ–°ç§»åŠ¨çŠ¶æ€
			updateMoveStateFromJoystick();
		}

		// é‡ç½®æ‘‡æ†ä½ç½®
		function resetJoystick() {
			joystickPosition.x = 0;
			joystickPosition.y = 0;
			joystickHandle.style.transform = 'translate(-50%, -50%)';
			
			// é‡ç½®ç§»åŠ¨çŠ¶æ€
			moveState.forward = false;
			moveState.backward = false;
			moveState.left = false;
			moveState.right = false;
		}

		// æ ¹æ®æ‘‡æ†ä½ç½®æ›´æ–°ç§»åŠ¨çŠ¶æ€ - ä¿®å¤æ–¹å‘é—®é¢˜
		function updateMoveStateFromJoystick() {
			const deadZone = 10; // æ­»åŒºï¼Œé¿å…å¾®å°ç§»åŠ¨
			
			// é‡ç½®ç§»åŠ¨çŠ¶æ€
			moveState.forward = false;
			moveState.backward = false;
			moveState.left = false;
			moveState.right = false;
			
			// æ£€æŸ¥æ˜¯å¦åœ¨æ­»åŒºå†…
			if (Math.abs(joystickPosition.x) < deadZone && Math.abs(joystickPosition.y) < deadZone) {
				return;
			}
			
			// æ ¹æ®æ‘‡æ†ä½ç½®è®¾ç½®ç§»åŠ¨æ–¹å‘ - ä¿®å¤æ–¹å‘é—®é¢˜
			// ç°åœ¨ï¼šå‘ä¸Šæ¨æ˜¯å‘å‰ï¼Œå‘ä¸‹æ¨æ˜¯å‘åï¼Œå‘å·¦æ¨æ˜¯å‘å·¦ï¼Œå‘å³æ¨æ˜¯å‘å³
			if (joystickPosition.y < -deadZone) {
				moveState.forward = true;
			} else if (joystickPosition.y > deadZone) {
				moveState.backward = true;
			}
			
			if (joystickPosition.x < -deadZone) {
				moveState.left = true;
			} else if (joystickPosition.x > deadZone) {
				moveState.right = true;
			}
		}

		// åˆ›å»ºä¸–ç•Œ
		function createWorld() {
			const worldSize = 16;
			
			// åˆ›å»ºåœ°é¢
			for (let x = -worldSize; x <= worldSize; x++) {
				for (let z = -worldSize; z <= worldSize; z++) {
					// åˆ›å»ºåœ°å½¢é«˜åº¦å˜åŒ–
					const height = Math.floor(Math.sin(x * 0.2) * Math.cos(z * 0.2) * 3);
					
					// åˆ›å»ºåœ°é¢æ–¹å—
					for (let y = -5; y <= height; y++) {
						const blockType = y === height ? 'grass' : (y > height - 3 ? 'dirt' : 'stone');
						addBlock(x, y, z, blockType);
					}
					
					// éšæœºæ”¾ç½®ä¸€äº›æ ‘æœ¨
					if (Math.random() < 0.05 && height >= 0) {
						const treeHeight = 4 + Math.floor(Math.random() * 3);
						
						// æ ‘å¹²
						for (let y = height + 1; y <= height + treeHeight; y++) {
							addBlock(x, y, z, 'wood');
						}
						
						// æ ‘å¶
						for (let dx = -2; dx <= 2; dx++) {
							for (let dz = -2; dz <= 2; dz++) {
								for (let dy = height + treeHeight - 1; dy <= height + treeHeight + 2; dy++) {
									// åˆ›å»ºçƒå½¢æ ‘å¶
									if (Math.sqrt(dx*dx + dz*dz + (dy - (height + treeHeight + 0.5))*(dy - (height + treeHeight + 0.5))) <= 2.5) {
										addBlock(x + dx, dy, z + dz, 'leaves');
									}
								}
							}
						}
					}
				}
			}
		}

		// æ·»åŠ æ–¹å—
		function addBlock(x, y, z, type) {
			const key = `${x},${y},${z}`;
			if (blocks.has(key)) return;
			
			// åˆ›å»ºæ–¹å—æè´¨
			const blockType = blockTypes.find(b => b.id === type);
			const geometry = new THREE.BoxGeometry(1, 1, 1);
			const material = new THREE.MeshLambertMaterial({ 
				color: blockType.color,
				transparent: type === 'water' || type === 'glass',
				opacity: type === 'water' ? 0.7 : (type === 'glass' ? 0.5 : 1)
			});
			const block = new THREE.Mesh(geometry, material);
			block.position.set(x, y, z);
			block.userData = { type, x, y, z };
			scene.add(block);
			blocks.set(key, block);
		}

		// ç§»é™¤æ–¹å—
		function removeBlock(x, y, z) {
			const key = `${x},${y},${z}`;
			if (blocks.has(key)) {
				const block = blocks.get(key);
				scene.remove(block);
				blocks.delete(key);
				
				// åˆ›å»ºæ‰è½ç‰©
				createItemDrop(x, y, z, block.userData.type);
				
				return true;
			}
			return false;
		}

		// åˆ›å»ºæ‰è½ç‰©
		function createItemDrop(x, y, z, type) {
			const blockType = blockTypes.find(b => b.id === type);
			const geometry = new THREE.SphereGeometry(0.2, 8, 8);
			const material = new THREE.MeshLambertMaterial({ color: blockType.color });
			const drop = new THREE.Mesh(geometry, material);
			drop.position.set(x + 0.5, y + 0.5, z + 0.5);
			drop.userData = { 
				type: type,
				velocity: new THREE.Vector3(
					(Math.random() - 0.5) * 0.1,
					0.2,
					(Math.random() - 0.5) * 0.1
				),
				collected: false
			};
			scene.add(drop);
			itemDrops.push(drop);
		}

		// æ›´æ–°æ‰è½ç‰©
		function updateItemDrops() {
			for (let i = itemDrops.length - 1; i >= 0; i--) {
				const drop = itemDrops[i];
				
				// åº”ç”¨é‡åŠ›
				drop.userData.velocity.y -= 0.01;
				
				// æ›´æ–°ä½ç½®
				drop.position.add(drop.userData.velocity);
				
				// æ£€æŸ¥æ˜¯å¦ä¸ç©å®¶ç¢°æ’
				const distance = drop.position.distanceTo(camera.position);
				if (distance < 1.5 && !drop.userData.collected) {
					// æ”¶é›†æ‰è½ç‰©
					collectItemDrop(drop, i);
				}
				
				// æ£€æŸ¥æ˜¯å¦è½åœ°
				const blockBelow = getBlock(
					Math.floor(drop.position.x),
					Math.floor(drop.position.y - 0.3),
					Math.floor(drop.position.z)
				);
				
				if (blockBelow) {
					drop.position.y = Math.floor(drop.position.y) + 0.5;
					drop.userData.velocity.y = 0;
				}
				
				// å¦‚æœæ‰è½ç‰©å¤ªè¿œï¼Œç§»é™¤å®ƒ
				if (drop.position.distanceTo(camera.position) > 20) {
					scene.remove(drop);
					itemDrops.splice(i, 1);
				}
			}
		}

		// æ”¶é›†æ‰è½ç‰©
		function collectItemDrop(drop, index) {
			drop.userData.collected = true;
			
			// æ·»åŠ åˆ°èƒŒåŒ…
			const existingItemIndex = backpack.findIndex(item => item && item.type === drop.userData.type);
			
			if (existingItemIndex !== -1) {
				backpack[existingItemIndex].count++;
			} else {
				const emptySlotIndex = backpack.findIndex(item => item === null);
				if (emptySlotIndex !== -1) {
					backpack[emptySlotIndex] = { type: drop.userData.type, count: 1 };
				}
			}
			
			// ä»åœºæ™¯ä¸­ç§»é™¤æ‰è½ç‰©
			scene.remove(drop);
			itemDrops.splice(index, 1);
			
			// æ›´æ–°èƒŒåŒ…UI
			updateBackpackUI();
		}

		// è·å–æ–¹å—
		function getBlock(x, y, z) {
			const key = `${x},${y},${z}`;
			return blocks.get(key);
		}

		// æ£€æŸ¥ä½ç½®æ˜¯å¦æœ‰æ–¹å—
		function hasBlock(x, y, z) {
			const key = `${Math.floor(x)},${Math.floor(y)},${Math.floor(z)}`;
			return blocks.has(key);
		}

		// å°„çº¿æ£€æµ‹
		function raycast(from, direction, maxDistance = 10) {
			const raycaster = new THREE.Raycaster(from, direction);
			const blockArray = Array.from(blocks.values());
			
			if (blockArray.length === 0) return null;
			
			const intersects = raycaster.intersectObjects(blockArray);
			
			if (intersects.length > 0 && intersects[0].distance <= maxDistance) {
				return intersects[0];
			}
			return null;
		}

		// æ”¹è¿›çš„ç¢°æ’æ£€æµ‹ - é˜²æ­¢ç©¿å¢™
		function checkCollision(newPos) {
			// ç©å®¶ç¢°æ’ç›’çš„å„ä¸ªç‚¹
			const points = [
				// åº•éƒ¨ç‚¹
				{ x: newPos.x - playerRadius, y: newPos.y - playerHeight/2, z: newPos.z - playerRadius },
				{ x: newPos.x + playerRadius, y: newPos.y - playerHeight/2, z: newPos.z - playerRadius },
				{ x: newPos.x - playerRadius, y: newPos.y - playerHeight/2, z: newPos.z + playerRadius },
				{ x: newPos.x + playerRadius, y: newPos.y - playerHeight/2, z: newPos.z + playerRadius },
				
				// é¡¶éƒ¨ç‚¹
				{ x: newPos.x - playerRadius, y: newPos.y + playerHeight/2, z: newPos.z - playerRadius },
				{ x: newPos.x + playerRadius, y: newPos.y + playerHeight/2, z: newPos.z - playerRadius },
				{ x: newPos.x - playerRadius, y: newPos.y + playerHeight/2, z: newPos.z + playerRadius },
				{ x: newPos.x + playerRadius, y: newPos.y + playerHeight/2, z: newPos.z + playerRadius },
				
				// ä¸­é—´ç‚¹
				{ x: newPos.x - playerRadius, y: newPos.y, z: newPos.z },
				{ x: newPos.x + playerRadius, y: newPos.y, z: newPos.z },
				{ x: newPos.x, y: newPos.y, z: newPos.z - playerRadius },
				{ x: newPos.x, y: newPos.y, z: newPos.z + playerRadius },
			];
			
			// æ£€æŸ¥æ‰€æœ‰ç‚¹æ˜¯å¦ä¸æ–¹å—ç¢°æ’
			for (const point of points) {
				if (hasBlock(point.x, point.y, point.z)) {
					return true;
				}
			}
			
			return false;
		}

		// è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
		function setupEventListeners() {
			// é”®ç›˜äº‹ä»¶
			document.addEventListener('keydown', (event) => {
				switch (event.code) {
					case 'KeyW':
					case 'ArrowUp':
						moveState.forward = true;
						break;
					case 'KeyS':
					case 'ArrowDown':
						moveState.backward = true;
						break;
					case 'KeyA':
					case 'ArrowLeft':
						moveState.left = true;
						break;
					case 'KeyD':
					case 'ArrowRight':
						moveState.right = true;
						break;
					case 'Space':
						if (isOnGround) {
							moveState.jump = true;
						}
						break;
					case 'Digit1':
					case 'Digit2':
					case 'Digit3':
					case 'Digit4':
					case 'Digit5':
						const index = parseInt(event.code[5]) - 1;
						if (index < inventory.length && inventory[index]) {
							currentBlockType = inventory[index].type;
							updateBlockIndicator();
							updateActiveInventorySlot();
						}
						break;
					case 'KeyE':
						toggleBackpack();
						break;
				}
			});

			document.addEventListener('keyup', (event) => {
				switch (event.code) {
					case 'KeyW':
					case 'ArrowUp':
						moveState.forward = false;
						break;
					case 'KeyS':
					case 'ArrowDown':
						moveState.backward = false;
						break;
					case 'KeyA':
					case 'ArrowLeft':
						moveState.left = false;
						break;
					case 'KeyD':
					case 'ArrowRight':
						moveState.right = false;
						break;
					case 'Space':
						moveState.jump = false;
						break;
				}
			});

			// é¼ æ ‡æ»šè½®åˆ‡æ¢æ–¹å—
			document.addEventListener('wheel', (event) => {
				if (document.pointerLockElement === renderer.domElement) {
					event.preventDefault();
					const currentIndex = inventory.findIndex(item => item && item.type === currentBlockType);
					let newIndex;
					
					if (event.deltaY > 0) {
						// å‘ä¸‹æ»šåŠ¨ï¼Œé€‰æ‹©ä¸‹ä¸€ä¸ªæ–¹å—
						newIndex = (currentIndex + 1) % inventory.length;
					} else {
						// å‘ä¸Šæ»šåŠ¨ï¼Œé€‰æ‹©ä¸Šä¸€ä¸ªæ–¹å—
						newIndex = (currentIndex - 1 + inventory.length) % inventory.length;
					}
					
					// æ‰¾åˆ°ä¸‹ä¸€ä¸ªæœ‰ç‰©å“çš„æ’æ§½
					let attempts = 0;
					while (attempts < inventory.length) {
						if (inventory[newIndex]) {
							currentBlockType = inventory[newIndex].type;
							updateBlockIndicator();
							updateActiveInventorySlot();
							break;
						}
						newIndex = (newIndex + 1) % inventory.length;
						attempts++;
					}
				}
			});

			// é¼ æ ‡äº‹ä»¶
			let isMouseDown = false;
			let mouseButton = 0;

			document.addEventListener('mousedown', (event) => {
				isMouseDown = true;
				mouseButton = event.button;
				
				if (mouseButton === 2) {
					event.preventDefault();
				}
				
				// å¼€å§‹æŒ–æ˜æˆ–æ”¾ç½®æ–¹å—
				if (mouseButton === 0) {
					// å¼€å§‹æŒ–æ˜
					startMining();
				} else if (mouseButton === 2) {
					// ç«‹å³å¤„ç†æ–¹å—æ”¾ç½®
					handleBlockAction(mouseButton);
				}
			});

			document.addEventListener('mouseup', (event) => {
				isMouseDown = false;
				mouseButton = event.button;
				
				// åœæ­¢æŒ–æ˜
				if (mouseButton === 0) {
					stopMining();
				}
			});

			document.addEventListener('contextmenu', (event) => {
				event.preventDefault();
			});

			// è§†è§’æ§åˆ¶
			document.addEventListener('mousemove', (event) => {
				if (document.pointerLockElement === renderer.domElement) {
					yaw -= event.movementX * mouseSensitivity * 0.002;
					pitch -= event.movementY * mouseSensitivity * 0.002;
					pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));
				}
			});

			// çµæ•åº¦æ§åˆ¶
			const sensitivitySlider = document.getElementById('sensitivity-slider');
			const sensitivityValue = document.getElementById('sensitivity-value');
			
			sensitivitySlider.addEventListener('input', (e) => {
				mouseSensitivity = parseFloat(e.target.value);
				sensitivityValue.textContent = mouseSensitivity.toFixed(1);
			});

			// è¯·æ±‚æŒ‡é’ˆé”å®š
			renderer.domElement.addEventListener('click', () => {
				if (!isMobile) {
					renderer.domElement.requestPointerLock();
				}
			});

			// å…³é—­èƒŒåŒ…æŒ‰é’®
			document.getElementById('close-backpack').addEventListener('click', () => {
				toggleBackpack();
			});

			// ç§»åŠ¨è®¾å¤‡æ§åˆ¶
			if (isMobile) {
				document.getElementById('jump-btn').addEventListener('touchstart', (e) => {
					if (isOnGround) moveState.jump = true;
					e.preventDefault();
				});
				document.getElementById('jump-btn').addEventListener('touchend', (e) => {
					moveState.jump = false;
					e.preventDefault();
				});
				
				document.getElementById('break-btn').addEventListener('touchstart', (e) => {
					startMining();
					e.preventDefault();
				});
				
				document.getElementById('break-btn').addEventListener('touchend', (e) => {
					stopMining();
					e.preventDefault();
				});
				
				document.getElementById('place-btn').addEventListener('touchstart', (e) => {
					handleBlockAction(2); // æ”¾ç½®
					e.preventDefault();
				});
				
				document.getElementById('backpack-btn').addEventListener('touchstart', (e) => {
					toggleBackpack();
					e.preventDefault();
				});
				
				// è§¦æ‘¸è§†è§’æ§åˆ¶
				let lastTouchX = 0;
				let lastTouchY = 0;
				let isRotating = false;

				document.addEventListener('touchstart', (event) => {
					if (event.touches.length === 1 && !joystickActive) {
						isRotating = true;
						lastTouchX = event.touches[0].clientX;
						lastTouchY = event.touches[0].clientY;
					å¦‚æœ
				å¦‚æœ);

				document.addEventListener('touchmove', (event) => {
					if.x=moveVector.xï¼›(isRotating && event.touches.length === 1 && !joystickActive) {
						const touch = event.touches[0];
						const deltaX = touch.clientX - lastTouchX;
						const deltaY = touch.clientY - lastTouchY;
						
						yaw -= deltaX * mouseSensitivity * 0.003;
						pitch -= deltaY * mouseSensitivity * 0.003;
						pitch = Math.max(-Math.PI/2, Math.min(Math.PI/2, pitch));
						
						lastTouchX = touch.clientX;
						lastTouchY = touch.clientY;
					}
				});

				document.addEventListener('touchend', () => {
					isRotating = false;
				});
			}

			// çª—å£å¤§å°è°ƒæ•´
			window.addEventListener('resize', onWindowResize);
		}

		// å¼€å§‹æŒ–æ˜
		function startMining() {
			const rayDirection = new THREE.Vector3(0, 0, -1);
			rayDirection.applyEuler(camera.rotation);
			
			const intersection = raycast(camera.position, rayDirection, 10);
			
			if (intersection) {
				isMining = true;
				miningTarget = intersection.object;
				miningProgress = 0;
				
				// æ ¹æ®æ–¹å—ç¡¬åº¦è°ƒæ•´æŒ–æ˜é€Ÿåº¦
				const blockType = blockTypes.find(b => b.id === miningTarget.userData.type);
				miningSpeed = 0.02 / blockType.hardness;
				
				document.getElementById('mining-progress').style.display = 'block';
				document.getElementById('mining-progress-bar').style.width = '0%';
			}
		}

		// åœæ­¢æŒ–æ˜
		function stopMining() {
			isMining = false;
			miningTarget = null;
			miningProgress = 0;
			document.getElementById('mining-progress').style.display = 'none';
		}

		// æ›´æ–°æŒ–æ˜è¿›åº¦
		function updateMining() {
			if (!isMining || !miningTarget) return;
			
			miningProgress += miningSpeed; // æ ¹æ®æ–¹å—ç¡¬åº¦è°ƒæ•´æŒ–æ˜é€Ÿåº¦
			document.getElementById('mining-progress-bar').style.width = `${Math.min(miningProgress * 100, 100)}%`;
			
			if (miningProgress >= 1) {
				// æŒ–æ˜å®Œæˆï¼Œç§»é™¤æ–¹å—
				const blockPos = miningTarget.position;
				removeBlock(blockPos.x, blockPos.y, blockPos.z);
				stopMining();
			}
		}

		// å¤„ç†æ–¹å—æ“ä½œ
		function handleBlockAction(button) {
			const rayDirection = new THREE.Vector3(0, 0, -1);
			rayDirection.applyEuler(camera.rotation);
			
			const intersection = raycast(camera.position, rayDirection, 10);
			
			if (intersection) {
				const block = intersection.object;
				const blockPos = block.position;
				
				if (button === 2) { // æ”¾ç½®
					const faceNormal = intersection.face.normal;
					const placeX = blockPos.x + Math.round(faceNormal.x);
					const placeY = blockPos.y + Math.round(faceNormal.y);
					const placeZ = blockPos.z + Math.round(faceNormal.z);
					
					// ç¡®ä¿ä¸ä¼šåœ¨ç©å®¶ä½ç½®æ”¾ç½®æ–¹å—
					const playerBlockX = Math.floor(camera.position.x);
					const playerBlockY = Math.floor(camera.position.y - playerHeight/2);
					const playerBlockZ = Math.floor(camera.position.z);
					
					if (!(placeX === playerBlockX && placeY === playerBlockY && placeZ === playerBlockZ) &&
						!(placeX === playerBlockX && placeY === playerBlockY + 1 && placeZ === playerBlockZ) &&
						!checkCollision(new THREE.Vector3(placeX, placeY, placeZ))) {
						
						// æ£€æŸ¥ç‰©å“æ ä¸­æ˜¯å¦æœ‰è¯¥æ–¹å—
						const inventoryItem = inventory.find(item => item && item.type === currentBlockType);
						if (inventoryItem && inventoryItem.count > 0) {
							addBlock(placeX, placeY, placeZ, currentBlockType);
							inventoryItem.count--;
							updateInventoryUI();
						}
					}
				}
			}
		}

		// åˆ‡æ¢èƒŒåŒ…æ˜¾ç¤º
		function toggleBackpack() {
			const backpack = document.getElementById('backpack');
			if (backpack.style.display === 'block') {
				backpack.style.display = 'none';
				if (!isMobile) {
					document.exitPointerLock();
				}
			} else {
				backpack.style.display = 'block';
				if (!isMobile) {
					document.exitPointerLock();
				}
			}
		}

		// çª—å£å¤§å°è°ƒæ•´å¤„ç†
		function onWindowResize() {
			const container = document.getElementById('gameContainer');
			camera.aspect = container.clientWidth / container.clientHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(container.clientWidth, container.clientHeight);
		}

		// æ¸¸æˆå¾ªç¯
		function animate() {
			if (!gameInitialized) return;
			
			requestAnimationFrame(animate);
			
			// æ›´æ–°æŒ–æ˜è¿›åº¦
			if (isMining) {
				updateMining();
			}
			
			// æ›´æ–°æ‰è½ç‰©
			updateItemDrops();
			
			// æ›´æ–°ç›¸æœºæ–¹å‘
			camera.rotation.order = 'YXZ';
			camera.rotation.y = yaw;
			camera.rotation.x = pitch;
			
			// å¤„ç†ç§»åŠ¨
direction.z=æ•°å­—(moveState.forward)-æ•°å­—(moveState.backward)ï¼›
direction.x=æ•°å­—(moveState.right)-æ•°å­—(moveState.left)ï¼›
direction.normalize()ï¼›
			
// åº”ç”¨ç§»åŠ¨é€Ÿåº¦ - æ ¹æ®ç›¸æœºæ–¹å‘ç§»åŠ¨
å¸¸æ•°movespeed=10ï¼›
Const forward=æ–°çš„THREE.Vector3(0ï¼Œ0ï¼Œ-1)ï¼›
forward.applyå››å…ƒæ•°(camera.quaternion)ï¼›
forward.y=0ï¼›
forward.normalize()ï¼›
			
Const right=æ–°çš„THREE.Vector3(1ï¼Œ0ï¼Œ0)ï¼›
right.applyå››å…ƒæ•°(camera.quaternion)ï¼›
right.y=0ï¼›
right.normalize()ï¼›
			
// è®¡ç®—ç§»åŠ¨å‘é‡
const moveVector=new THREE.Vector3()ï¼›
if(æ–¹å‘ã€‚zï¼==0)moveVector.Add(å‘å‰.å…‹éš†()ã€‚multiplyScalar(æ–¹å‘.z*movespeed))ï¼›
if(æ–¹å‘ã€‚xï¼==0)moveVector.add(å³ã€‚å…‹éš†()ã€‚multiplyScalar(æ–¹å‘.x*movespeed))ï¼›
			
// è®¾ç½®æ°´å¹³é€Ÿåº¦
velocity.x=moveVector.xï¼›
velocity.z=moveVector.zï¼›
			
// åº”ç”¨é‡åŠ›
velocity.y+=é‡åŠ›*0.016ï¼›
			
// è·³è·ƒ
if(moveState.jump&&isOnGround){
velocity.y=10ï¼›
isOnGround=falseï¼›
			}
			
// åº”ç”¨ç§»åŠ¨ - ä½¿ç”¨æ”¹è¿›çš„ç¢°æ’æ£€æµ‹
Const delta=é€Ÿåº¦.å…‹éš†().ä¹˜ä»¥æ ‡é‡(0.016)ï¼›
Const newpos=camera.position.clone().add(delta)ï¼›
			
// æ£€æŸ¥ç¢°æ’
if(ï¼checkCollision(newpos)){
camera.position.copy(newpos)ï¼›
}else{
//å¦‚æœç¢°æ’ï¼Œå°è¯•åˆ†åˆ«æ£€æŸ¥Xå’ŒZæ–¹å‘çš„ç§»åŠ¨
constconst newPosX=new THREE.Vector3(newPos.xï¼Œç›¸æœº.ä½ç½®.yï¼Œç›¸æœº.position.z)ï¼›newPosX=new THREE.Vector3(newPos.xï¼Œç›¸æœº.ä½ç½®.yï¼Œç›¸æœº.position.z)ï¼›
if(ï¼checkCollision(newPosX)){
camera.position.x=newPos.xï¼›
}
				
Const newPosZ=æ–°çš„ä¸‰å‘çŸ¢é‡3(camera.ä½ç½®ã€‚Xæ‘„åƒå¤´ä½ç½®yï¼Œnewpos.z)ï¼›
if(ï¼checkCollision(newPosZ)){
camera.position.z=newPos.zï¼›
}
inventoryItem.count--ï¼›
//æ£€æŸ¥Yæ–¹å‘ç¢°æ’
ConstnewPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosYå¸¸é‡newPosYå¸¸æ•°newPosY=æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X..z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œæ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X..z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X..z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„Xyï¼Œæ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X..z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œyï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœºæ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›æ–°ä¸‰å‘é‡3(ç›¸æœº.ä½ç½®å¸¦newposçš„X.yï¼Œç…§ç›¸æœº.ä½ç½®.z)ï¼›
å¦‚æœ(ï¼checkCollision(newPosY)){
ç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœºç›¸æœº.ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yä½ç½®..yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›ä½ç½®.y=newpos.yï¼›
}å…¶ä»–{
// å¦‚æœYæ–¹å‘ç¢°æ’ï¼Œæ£€æŸ¥æ˜¯ä¸Šæ–¹è¿˜æ˜¯ä¸‹æ–¹
å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦å¦‚æœ(é€Ÿåº¦)å¦‚æœ
// ä¸‹æ–¹ç¢°æ’ï¼Œç«™åœ¨åœ°é¢ä¸Š
å‡½æ•°toggleBackpack(){æ­£ç¡®ï¼›æ­£ç¡®ï¼›æ­£ç¡®ï¼›æ­£ç¡®ï¼›æ­£ç¡®ï¼›æ­£ç¡®ï¼›æ­£ç¡®ï¼›æ­£ç¡®ï¼›æ­£ç¡®ï¼›æ­£ç¡®ï¼›
ã€‚
}å…¶ä»–{
// ä¸Šæ–¹ç¢°æ’ï¼Œåœæ­¢å‘ä¸Šç§»åŠ¨
ã€‚
}}
}}
}}
.
// æ£€æŸ¥æ˜¯å¦ç«™åœ¨åœ°é¢ä¸Š
ConstgroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstrounddCheckPosConstrounddCheckPosConstrounddCheckPosConstroundCheckPosConstrounddCheckPosConstrounddCheckPosConstrounddCheckPosConstrounddCheckPosConstrounddCheck KK kPosConstrounddCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundConst roundCheckPosConstroundCheckPosConstroundConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundConst roundCheckPosConstroundCheckPosConstroundRoundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundConstround ConstroundCheckPosConstroundCheckPosConstroundConstroundCheckPosConstroundConstroundCheckPosConstroundCheckPosConstrou ndConstroundConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheck PosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstrounddCheckPosConstrounddCheckPosConstrounddCheckPosConstrounddCheckPosConstrounddCheck KK kPosConstrounddCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundConst roundCheckPosConstroundCheckPosConstroundConst roundCheckPosConstroundCheckPosConstroundConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundConst roundConst roundCheckPosConstroundCheckPosConstroundRoundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstround CheckPosConstroundCheckPosConstroundCheckPosConstraundConstund ConstroundCheckPosConstroundCheckPosConstroundConstroundCheckPosConstroundConstroundCheckPosConstround ndConstroundConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstrondCheckPosConstroundCheckPosConstroundCheckPosConstroundConstround roundCheckPosConstroundCheckPosConstroundConst roundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundConstrundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheck kPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstra undCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckP osConstroundCheckPosConstroundå¾ªç¯æ£€æŸ¥PosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheck PosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheckPosConstroundCheck
groundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgr undCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckCheckPosgrè”åˆå›½ã€‚ygroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundPosg roundCheckPosgroundCheckPosgroundPosgroundCheckPosgroundPosgroundPosgroundCheckPosgroundCheckPosgroundCheckPosgroundPosgrou ndPosgroundPosgroundCheckPosgroundPosgroundCheckPosgroundå¾ªç¯æ£€æŸ¥PosgroundCheckPosgroundCheckPosgroundPosgroundCheckPosgroundCheckPosgroundCheckPosgrundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundChunå¾ªç¯æ£€æŸ¥PosgroundCheckPosgroundPosgroundCheckPosgroundCheckPosgroundPosgroundPosgroundCheckPosgroundCheckChe ckPosgroundCh eckPosgroundCheckPosgroundCheckPosPo sgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosg roundCheckPosgroundCheckPosgroundCheckPosgåœ†çš„eckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundYgroundCheckPosgroundCheckkPosgroundCheckPosgr o undCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundå¾ªç¯æ£€æŸ¥PosgroundCheckPosgroundPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundPolicyå¾ªç¯æ£€æŸ¥PosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosPosã€‚ygroundCheckPosgroundCheckPosgroundCheckkPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosGroundCheckPosæ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥æ¥åœ°æ£€æŸ¥ndCheckPosgroundPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundPolicyå¾ªç¯æ£€æŸ¥PosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckå¾ªç¯æ£€æŸ¥PosgroundCheckPosgroundCheckkPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckP osgroundCheckP osground ckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheckPosgroundCheck PosgroundCheckPosgroundCheckPosgroundCheckPosGroundCheckPosGroundCheckPosgroundCheckPosgCheckPosgroundCheckPosgroundæ’­æ”¾å™¨é«˜åº¦//2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›y-=æ’­æ”¾å™¨é«˜åº¦/2+0.1ï¼›
isOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGroundisOnGround=checkCollision(groundCheckPos)ï¼›checkCollision(groundCheckPos)ï¼›checkCollision(groundCheckPos)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(åœ°é¢æ£€æŸ¥ä½ç½®)ï¼›checkCollision(groundCheckPos)ï¼›checkCollision(groundCheckPos)ï¼›checkCollision(groundCheckPæ“ä½œç³»ç»Ÿ)ï¼›
			
// åº”ç”¨æ‘©æ“¦åŠ›
å¦‚æœ(isOnGround){
é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦ã€‚
é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦é€Ÿåº¦ã€‚
}å…¶ä»–{
ã€‚*=
ã€‚*=
}}
			
// æ¸²æŸ“åœºæ™¯
æ¸²æŸ“å™¨ã€‚ æ¸²æŸ“å™¨(åœºæ™¯ï¼Œæ‘„å½±æœº)ï¼›
}}

//ç­‰å¾…Three.jsåŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
å‡½æ•°checkThreeJSLoaded(){
// æ›´æ–°æŒ–æ˜è¿›åº¦='æœªå®šä¹‰'){'æœªå®šä¹‰'){ä¸‰ï¼ =='æœªå®šä¹‰'){'æœªå®šä¹‰'){ä¸‰ï¼ =='æœªå®šä¹‰'){'æœªå®šä¹‰'){ä¸‰ï¼ =='æœªå®šä¹‰'){'æœªå®šä¹‰'){ä¸‰ï¼ =='æœªå®šä¹‰'){'æœªå®šä¹‰'){ä¸‰ï¼ =='æœªå®šä¹‰'){
init()ï¼›
}å…¶ä»–{
setTimeout(checkThreeJSLoadedï¼Œ100)ï¼›
}}
}}

// é¡µé¢åŠ è½½å®Œæˆåå¼€å§‹åˆå§‹åŒ–
//æ›´æ–°ç›¸æœºæ–¹å‘ntentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ(){addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{addEventListener('DOMContentLoaded'ï¼Œ()=>{
checkThreeJSLoaded()ï¼›
;
<
<
<
